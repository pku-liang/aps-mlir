// Test 1: Basic array addition with burst operations
// Tests: readrf type inference, global arrays, burst operations

#[impl("1rw")]
static mem_a: [u32; 16];
static mem_b: [u32; 16];
static mem_c: [u32; 16];

#[opcode(7'b0101011)]
#[funct7(7'b0000000)]
rtype array_add(rs1: u5, rs2: u5, rd: u5) {
    // Load arrays from CPU memory
    let r1: u32 = _irf[rs1];
    let r2: u32 = _irf[rs2];
    mem_a[0 +: ] = _burst_read[r1 +: 16];
    mem_b[0 +: ] = _burst_read[r2 +: 16];

    // Compute: c[i] = a[i] + b[i]
    with i: u32 = (0, i_) do {
        let a: u32 = mem_a[i];
        let b: u32 = mem_b[i];
        let c: u32 = a + b;
        mem_c[i] = c;  // Store to mem_c
        let i_: u32 = i + 1;
    } while (i_ < 16);

    // Write result back to CPU memory
    _burst_write[r1 +: 16] = mem_c[0 +: ];
    _irf[rd] = 0;
}
